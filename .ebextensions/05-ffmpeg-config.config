# FFmpeg Configuration and Optimization
files:
  # FFmpeg wrapper script
  /usr/local/bin/ffmpeg-wrapper.sh:
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # FFmpeg wrapper with timeout and error handling
      timeout 300 ffmpeg "$@" 2>/dev/null
      exit_code=$?
      if [ $exit_code -eq 124 ]; then
          echo "FFmpeg timeout after 5 minutes"
          exit 1
      fi
      exit $exit_code

commands:
  01_create_temp_dirs:
    command: |
      # Create temporary directories for media processing
      mkdir -p /tmp/media_processing
      chmod 777 /tmp/media_processing
      
      # Set up log rotation for large files
      echo "/tmp/media_processing/*.log {
          daily
          missingok
          rotate 3
          compress
          notifempty
          create 644 webapp webapp
      }" > /etc/logrotate.d/media_processing
    ignoreErrors: true
    
  02_optimize_system:
    command: |
      # System optimizations for media processing
      echo "net.core.rmem_max = 16777216" >> /etc/sysctl.conf
      echo "net.core.wmem_max = 16777216" >> /etc/sysctl.conf
      sysctl -p
    ignoreErrors: true
